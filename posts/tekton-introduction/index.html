<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Pipelines com o Tekton - Introdução - Fábio Luciano</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Tekton  Características  É um projeto Open Source mantido pela CNCF; Todas os elementos são objetos do Kubernetes; É focado em reutilização(TriggerBinding, TriggerTemplate, Pipeline, Task); Seu funcionamento se dá pela implementação de CRDs(Custom Resource Definition) customizados para cada um dos elementos descritos posteriormente.   Ecossistema  Tekton Triggers - Pacote com os CRDs referentes a escuta de eventos e como respondê-los; Tekton Pipelines - Pacote com os CRDs referentes a construção de tasks, recursos e elementos referentes a pipeline; Tekton Dashboard - Interface para consumir informações de execuções de pipelines; Tekton Hub - Coleção de tasks disponíveis para execução de determinadas tarefas; CLI Tool - Ferramenta de linha de comando para consumir informações e executar ações no ecossistema;   Tekton Triggers  EventListener - Elemento responsável por interceptar as requisições feitas ao endereço do Ingress; Trigger - Elemento responsável por configurar os gatilhos que ativarão determinadas TriggerTemplates; TriggerBinding - Permite a captura de informações de um evento, e transformação em um parâmetro consumível pela Pipeline; TriggerTemplate - Cria um template de invocação de algum elemento do pacote de pipelines."><meta property="og:image" content><meta property="og:title" content="Pipelines com o Tekton - Introdução"><meta property="og:description" content="Tekton  Características  É um projeto Open Source mantido pela CNCF; Todas os elementos são objetos do Kubernetes; É focado em reutilização(TriggerBinding, TriggerTemplate, Pipeline, Task); Seu funcionamento se dá pela implementação de CRDs(Custom Resource Definition) customizados para cada um dos elementos descritos posteriormente.   Ecossistema  Tekton Triggers - Pacote com os CRDs referentes a escuta de eventos e como respondê-los; Tekton Pipelines - Pacote com os CRDs referentes a construção de tasks, recursos e elementos referentes a pipeline; Tekton Dashboard - Interface para consumir informações de execuções de pipelines; Tekton Hub - Coleção de tasks disponíveis para execução de determinadas tarefas; CLI Tool - Ferramenta de linha de comando para consumir informações e executar ações no ecossistema;   Tekton Triggers  EventListener - Elemento responsável por interceptar as requisições feitas ao endereço do Ingress; Trigger - Elemento responsável por configurar os gatilhos que ativarão determinadas TriggerTemplates; TriggerBinding - Permite a captura de informações de um evento, e transformação em um parâmetro consumível pela Pipeline; TriggerTemplate - Cria um template de invocação de algum elemento do pacote de pipelines."><meta property="og:type" content="article"><meta property="og:url" content="https://fabioluciano.dev/posts/tekton-introduction/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-03-01T00:00:00+00:00"><meta property="article:modified_time" content="2021-03-01T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Pipelines com o Tekton - Introdução"><meta name=twitter:description content="Tekton  Características  É um projeto Open Source mantido pela CNCF; Todas os elementos são objetos do Kubernetes; É focado em reutilização(TriggerBinding, TriggerTemplate, Pipeline, Task); Seu funcionamento se dá pela implementação de CRDs(Custom Resource Definition) customizados para cada um dos elementos descritos posteriormente.   Ecossistema  Tekton Triggers - Pacote com os CRDs referentes a escuta de eventos e como respondê-los; Tekton Pipelines - Pacote com os CRDs referentes a construção de tasks, recursos e elementos referentes a pipeline; Tekton Dashboard - Interface para consumir informações de execuções de pipelines; Tekton Hub - Coleção de tasks disponíveis para execução de determinadas tarefas; CLI Tool - Ferramenta de linha de comando para consumir informações e executar ações no ecossistema;   Tekton Triggers  EventListener - Elemento responsável por interceptar as requisições feitas ao endereço do Ingress; Trigger - Elemento responsável por configurar os gatilhos que ativarão determinadas TriggerTemplates; TriggerBinding - Permite a captura de informações de um evento, e transformação em um parâmetro consumível pela Pipeline; TriggerTemplate - Cria um template de invocação de algum elemento do pacote de pipelines."><script src=https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js></script><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@1,500&display=swap" rel=stylesheet><link href="https://fonts.googleapis.com/css2?family=Fira+Sans&display=swap" rel=stylesheet><link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://fabioluciano.dev/css/main.2f9b5946627215dc1ae7fa5f82bfc9cfcab000329136befeea5733f21e77d68f.css></head><body><div class=content><header><div class=main><a href=https://fabioluciano.dev>Fábio Luciano</a></div><nav><a href=/>Home</a>
<a href=/posts>Posts</a>
<a href=/about>Sobre</a>
<a href=/tags>Tags</a>
<a href=https://me.fabioluciano.dev/>Currículo</a></nav></header><main><article><div class=title><h1 class=title>Pipelines com o Tekton - Introdução</h1><div class=meta>Posted on Mar 1, 2021</div></div><section class=body><h1 id=tekton>Tekton</h1><hr><h2 id=características>Características</h2><ul><li>É um projeto Open Source mantido pela CNCF;</li><li>Todas os elementos são objetos do Kubernetes;</li><li>É focado em reutilização(<code>TriggerBinding</code>, <code>TriggerTemplate</code>, <code>Pipeline</code>, <code>Task</code>);</li><li>Seu funcionamento se dá pela implementação de <code>CRD</code>s(Custom Resource Definition) customizados para cada um dos elementos descritos posteriormente.</li></ul><hr><h2 id=ecossistema>Ecossistema</h2><ul><li><a href=https://tekton.dev/docs/triggers/>Tekton Triggers</a> - Pacote com os <code>CRDs</code> referentes a escuta de eventos e como respondê-los;</li><li><a href=https://tekton.dev/docs/pipelines/>Tekton Pipelines</a> - Pacote com os <code>CRDs</code> referentes a construção de tasks, recursos e elementos referentes a pipeline;</li><li><a href=https://tekton.dev/docs/dashboard/>Tekton Dashboard</a> - Interface para consumir informações de execuções de pipelines;</li><li><a href=https://hub-preview.tekton.dev/>Tekton Hub</a> - Coleção de tasks disponíveis para execução de determinadas tarefas;</li><li><a href=https://tekton.dev/docs/cli/>CLI Tool</a> - Ferramenta de linha de comando para consumir informações e executar ações no ecossistema;</li></ul><hr><h2 id=tekton-triggers>Tekton Triggers</h2><ul><li><a href=https://tekton.dev/docs/triggers/eventlisteners/>EventListener</a> - Elemento responsável por interceptar as requisições feitas ao endereço do <code>Ingress</code>;</li><li><a href=https://tekton.dev/docs/triggers/triggers/>Trigger</a> - Elemento responsável por configurar os gatilhos que ativarão determinadas <code>TriggerTemplate</code>s;</li><li><a href=https://tekton.dev/docs/triggers/triggerbindings/>TriggerBinding</a> - Permite a captura de informações de um evento, e transformação em um parâmetro consumível pela <code>Pipeline</code>;</li><li><a href=https://tekton.dev/docs/triggers/triggertemplates/>TriggerTemplate</a> - Cria um template de invocação de algum elemento do pacote de pipelines. (Eg. <code>PipelineRun</code>, <code>TaskRun</code>).</li></ul><hr><h3 id=eventlistener>EventListener</h3><ul><li>Cria uma <code>Service</code> que pode ser anexado a um <code>Ingress</code> para receber requisições externas (eg. Endereço utilizado no <code>webhook</code> do repositório);</li><li>É a entidade que aglomerá os <code>Trigger</code>s que tratarão as requisições ao <code>EventListener</code>.</li></ul><hr><h3 id=trigger>Trigger</h3><ul><li>O chaveamento entre qual pipeline deve ser executada é feito utilizando <code>interceptor</code>s;</li><li>Por padrão possui interceptors para <code>Github</code>, <code>Gitlab</code>, <code>Github</code> e <code>CEL</code>.</li><li>O interceptor <code>CEL</code> é o mais versátil, definindo filtros e overlays às informações.<ul><li><strong>Filtros</strong>: Informa quais campos da requisição vai disparar o gatilho. (eg. <code>"header.match('X-GitHub-Event', 'pull_request')"</code>);</li><li><strong>Overlays</strong>: Executa transformações em campos da requisição, para consumo na pipeline. (eg. <code>"body.pull_request.head.sha.truncate(7)"</code>).</li></ul></li></ul><hr><h3 id=triggerbinding>TriggerBinding</h3><ul><li>Traduz campos da requisição para parâmetros que serão consumidos na pipeline.</li><li>Os campos do envolope <code>HTTP</code> disponíveis são os <code>Headers</code> e <code>Body</code>.</li></ul><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>triggered-event</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>$(header.X-Github-Event)</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>event-action</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>$(body.action)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></code></pre></div><hr><h3 id=triggertemplate>TriggerTemplate</h3><ul><li>Neste objeto são configurados os templates padrão para cada evento disparado em um dos <code>Triggers</code>;</li><li>Recebe os parâmetros de uma <code>TriggerBinding</code> e os atribui a um <code>PipelineRun</code> ou <code>TaskRun</code>;</li></ul><hr><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>graph TD;
    GithubWebhookEvent(Github Event)--&gt;|Envia um json para o webhook|IngressEventListener(Ingress);
    IngressEventListener--&gt;
|Chama a Service exposta|EventListener(EventListener);
    EventListener --&gt;|Carrega todos os triggers configurados| Trigger;
    Trigger --&gt;|Passa o conteúdo do evento| TriggerBinding;
    TriggerBinding --&gt;|Cria variáveis que serão consumidas | TriggerTemplate;
    TriggerTemplate --&gt;|Invoca uma execução de pipeline| PipelineRun;
</code></pre></div><hr><h2 id=tekton-pipelines>Tekton Pipelines</h2><ul><li><a href=https://tekton.dev/docs/pipelines/pipelines/>Pipeline</a> - Objeto que agrupa <code>Task</code>s comuns à pipeline;</li><li><a href=https://tekton.dev/docs/pipelines/pipelineruns/>PipelineRun</a> - Instancia e executa uma <code>Pipeline</code>;</li><li><a href=https://tekton.dev/docs/pipelines/resources/>PipelineResource</a> - Objetos que serão utilizados como entradas/saídas de uma <code>Task</code>;</li><li><a href=https://tekton.dev/docs/pipelines/tasks/>Task</a> - É uma coleção de <code>Steps</code> a serem executados para conclusão de uma determinada tarefa;</li><li><a href=https://tekton.dev/docs/pipelines/taskruns/>TaskRun</a> - Instancia e executa uma determinada <code>Task</code>;</li></ul><hr><h3 id=pipeline>Pipeline</h3><ul><li>Agrupa <code>Tasks</code> para um fim específico;</li><li>Os parâmetros são inputados por um objeto <code>PipelineRun</code>;</li><li>Pode possuir recursos que são esperados.(Eg. repositório, pullrequest, imagem docker)</li><li>Vários repositórios podem consumir a mesma pipeline, com parâmetros diferentes.</li><li>Os volumes, utilizados para transição de informações entre <code>Tasks</code> são denominados workspaces.</li><li>Workspaces podem ser utilizados para reutilizar bibliotecas e acelerar o processo de build (node_modules(nodejs/frontend), .terraform(:P), .m2(JAVA), vendor(PHP))</li></ul><hr><h3 id=pipelineresource>PipelineResource</h3><ul><li>Ajudam a abstrair os recursos consumidos por uma <code>Pipeline</code>/<code>Task</code>;</li><li>Podem ser de entrada(input), ou de saída(output);</li><li>Podem ser dos tipos: <code>Git</code>, <code>PullRequest</code>, <code>Image</code>, <code>Cluster</code>, <code>GCS</code> e <code>CloudEvent</code>.</li></ul><hr><h3 id=task>Task</h3><ul><li>O padrão <a href=https://www.magalix.com/blog/kubernetes-patterns-the-init-container-pattern>init-container</a> é utilizado para garantir a execução ordenada das tasks</li><li>É executada em um <code>Pod</code> no cluster;</li><li>Possui uma versão que transpõem o namespace <code>ClusterTask</code>;</li><li>Cada <code>Step</code> dentro de uma <code>Task</code> é traduzido em um container sendo executado.</li><li>Como um objeto do Kubernetes, pode consumir outros objetos, como <code>ConfigMaps</code> e <code>Secrets</code>.</li></ul><hr><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>tekton.dev/v1beta1</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ClusterTask</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>webhook-debug</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span><span style=color:#8f5902;font-style:italic>      </span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>Imprime as informações informadas pelo webhook</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>params</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>pipelinerun-name</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Nome do pipelinerun executado</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>repo-name</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Nome do repositório</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>steps</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>print-webhook-informations</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>alpine:latest</span><span style=color:#f8f8f8;text-decoration:underline>
</span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>script</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span><span style=color:#8f5902;font-style:italic>        #!/usr/bin/env sh
</span><span style=color:#8f5902;font-style:italic>        echo &#34;$(inputs.params.pipelinerun-name)&#34;
</span><span style=color:#8f5902;font-style:italic>        echo &#34;$(inputs.params.repo-name)&#34;</span><span style=color:#f8f8f8;text-decoration:underline>        
</span></code></pre></div><hr><div class=highlight><pre style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>graph TD;
    PipelineRun --&gt;|Instancia uma pipeline com determinados parâmetros| Pipeline;
    Pipeline --&gt;|Instancia uma lista de tarefas| TaskRun;
    TaskRun --&gt;|Instancia uma tarefa| Task;
    Task --&gt;|Executa procedimentos para execução de uma tarefa| Steps;
</code></pre></div></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/tekton>tekton</a></li></ul></nav></div></article></main><footer><hr><a class=soc href=https://github.com/fabioluciano/ title=GitHub><i data-feather=github></i></a>|<a class=soc href=https://twitter.com/fabioluciano/ title=Twitter><i data-feather=twitter></i></a>|<a class=soc href=https://me.fabioluciano.dev/ title=Currículo><i data-feather=user></i></a>|⚡️
2021 Fábio Luciano | <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></footer><script>feather.replace()</script></div></body></html>